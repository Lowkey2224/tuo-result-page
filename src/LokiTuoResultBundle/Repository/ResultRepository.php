<?php

namespace LokiTuoResultBundle\Repository;

use LokiTuoResultBundle\Entity\Mission;

/**
 * ResultRepository.
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ResultRepository extends AbstractBaseRepository
{
    public function findResultsWithPlayerAndDecks(Mission $mission, $orderBy = ['id' => 'ASC'])
    {
        $qb = $this->createQueryBuilder('result')
            ->select('result', 'player', 'deck', 'card', 'guild')
        ->where('result.mission = :mission')
        ->setParameter('mission', $mission)
        ->join('result.player', 'player')
        ->join('player.guild', 'guild')
        ->join('result.deck', 'deck')
        ->join('deck.card', 'card');
        foreach ($orderBy as $col => $dir) {
            $qb->orderBy($col, $dir);
        }
        return $qb->getQuery()->getResult();
    }
}
